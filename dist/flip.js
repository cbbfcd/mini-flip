!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).flip=i()}(this,function(){"use strict";const t=(t,i)=>{if(!t)throw new Error(`[flipjs] ${i}`)},i=(i,s)=>{t("string"==typeof s,"className must be string type."),i.classList.add(s)},s=(t,i)=>t.currentStyle?t.currentStyle[i]:getComputedStyle(t,!1)[i],e=(t,i,s=null,e=!0,a=!0)=>{const n=new CustomEvent(i,{detail:s,bubbles:e,cancelable:a});t.dispatchEvent(n)};var a={play(){t("string"==typeof this._easing,"\n      waap player only support string easing value for now.\n      reference: https://www.w3schools.com/jsref/prop_style_transitiontimingfunction.asp.\n    ");const i=[{transformOrigin:this._transformOrigin,transform:`\n          translate(${this._invert.x}px, ${this._invert.y}px) \n          scale(${this._invert.sx}, ${this._invert.sy})\n        `,opacity:this._first.opacity},{transformOrigin:this._transformOrigin,transform:"none",opacity:this._last.opacity}],s={delay:this._delay,duration:this._duration,easing:this._easing,fill:this._fill,direction:this._direction,iterationStart:this._iterationStart,iterations:this._iterations},e=this._target.animate(i,s);return e.onfinish=(()=>{this.cleanUpAndFire()}),e}},n={play(i){"linear"===this._easing&&(this._easing=(t=>t)),t("function"==typeof this._easing,"the raf player requires that easing be a function."),this._start=i?i+this._delay:window.performance.now()+this._delay;const s=()=>{let t=(window.performance.now()-this._start)/this._duration;t=((t,i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY)=>Math.min(s,Math.max(i,t)))(t,0,1);let i=this._easing(t),e={x:this._invert.x*(1-i),y:this._invert.y*(1-i),sx:this._invert.sx+i*(1-this._invert.sx),sy:this._invert.sy+i*(1-this._invert.sy),a:this._first.opacity+i*this._invert.a};this._transform&&(this._target.style.transform=`\n          translate(${e.x}px, ${e.y}px)\n          scale(${e.sx}, ${e.sy})\n        `),this._opacity&&(this._target.style.opacity=e.a),t<1?requestAnimationFrame(s):this.cleanUpAndFire()};requestAnimationFrame(s)}};class r{constructor(){t(new.target!==r,"FlipCore cannot be instantiated and can only be inherited.")}static get version(){return"v1.0.1"}static get players(){return this._cache}static extends(i,s){this._cache||(this._cache={}),t(!this._cache[i],`player ${i} already exists.`),t(!!s.play,"player must have a play() function."),this._cache[i]=s}}class o extends r{constructor(i={}){super();const s=Object.assign({},{play:"WAAP",customPlay:"",transform:!0,opacity:!0,duration:300,delay:0,easing:"linear",direction:"normal",transformOrigin:"0 0",fill:"both",iterationStart:"0.0",iterations:"1"},i);t(s.target,"the target dom node must be provided."),this._start=0,this._target=s.target,Object.keys(s).forEach(t=>{s.hasOwnProperty(t)&&(this[`_${t}`]=s[t])});const e=o._cache[s.customPlay?s.customPlay:s.play];let a;t(e,`unkown player ${s.customPlay?s.customPlay:s.play}.`),t(e.play,"player must have a play() function."),this.cleanUpAndFire=this.cleanUpAndFire.bind(this),Object.keys(e).forEach(t=>{a=e[t],this[`_${t}`]=a.bind(this)}),this._first={layout:null,opacity:0},this._last={layout:null,opacity:0},this._invert={x:0,y:0,sx:1,sy:1,a:0,d:!1}}cleanUpAndFire(){const t=this._target.style,i=this._first,s=this._last,a=this._invert;t.transform=null,t.transformOrigin=null,t.willChange=null,t.opacity=null,i.layout=null,i.opacity=0,s.layout=null,s.opacity=0,a.x=0,a.y=0,a.sx=1,a.sy=1,a.a=0,a.d=!1,e(this._target,"flipComplete")}snapshot(t){return this.first().last(t).invert()}first(){return this._first.layout=this._target.getBoundingClientRect(),this._first.opacity=parseFloat(s(this._target,"opacity")),this}last(t){return t&&i(this._target,t),this._last.layout=this._target.getBoundingClientRect(),this._last.opacity=parseFloat(s(this._target,"opacity")),this}invert(){let i=[],s=this._target.style,e=this._invert;t(this._first.layout,"please call first() before invert()."),t(this._last.layout,"please call last() before invert().");const{layout:{left:a,top:n,width:r,height:o},opacity:l}=this._first,{layout:{left:h,top:c,width:y,height:p},opacity:_}=this._last;return Object.assign(e,{x:a-h,y:n-c,sx:r/y,sy:o/p,a:_-l,d:!0}),this._transform&&(s.transformOrigin=this._transformOrigin,s.transform=`translate(${e.x}px, ${e.y}px) scale(${e.sx}, ${e.sy})`,i.push("transform")),this._opacity&&(s.opacity=l,i.push("opacity")),s.willChange=i.join(","),this}play(i){return t(this._invert.d,"please call invert() brfore play()."),this._play(i)}}return o.extends("WAAP",a),o.extends("RAF",n),o});
